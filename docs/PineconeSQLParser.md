# Pinecone SQL Parser

By follow Pinecone's syntax defined when write your SQL query, variable will be transformed dynamically at run time.
The purpose is to unify syntax across many SQL dialects as well as support Manual Reconciliation and Global Time Rollout feature.
<br /> Mostly build to support time variance for different use cases, the parser try to parse variable to the most generic value which supported by vary SQL dialects.

## Syntax
Support 2 syntax operators: `${}` and `$TIME{}`.

The functionality of these two are mostly same identical. The only different is `$TIME{}` can be replaced with anual syntax when doing Manual Reconciliation. 
For example: you want to run your custom time variables without edit the original query, you will pass your variables to the parser, and `$TIME{CONTENT}` will be replaced with your param, while `${}` remain the same.

You can place many operators as you want. Be aware that in order to use Manual Reconciliation, you can only put one `$TIME{}` operator due to difficult on Parser side (may eliminate in future).
`$TIME{}` still can be parsed as many times as it appeared as long as you don't use it in Manual Reconciliation.

### Function
Function supported by Pinecone will place inside the bracket `{}`.
From now on, I will use `${}` for short, but the same utility can be extended for `$TIME{}`.

| Function                   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Example                                                                                                                                                                                                                        |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `GET_DATE(offset) -> T`         | Category: `TIME`<br/>  Get the date with option to pass offset parameter accordingly.<br/>  Param: `offset: INT`: Subtract DAYS from CURRENT_DATE. This param is optional, default is 0.  Could be negative or positive number.<br/>  Return: `YYYY-MM-DD`                                                                                                                                                                                                                                                                     | CURRENT_DATE = `2021-06-15`<br/><br/> `GET_DATE()` -> `2021-06-15`<br/> `GET_DATE(0)` -> `2021-06-15` <br/>`GET_DATE(-1)` -> `2021-06-14` (yesterday) <br/>`GET_DATE(1)` -> `2021-06-16` (tomorrow)                                                             |
| `GET_TIMESTAMP(offset) -> T`    | Category: `TIME`<br/>  Same with `GET_DATE` but return TIMESTAMP level instead.<br/>  Param: `offset: INT`: Only different is Subtract SECONDS from CURRENT_TIMESTAMP.<br/>  Return: `YYYY-MM-DD HH24:MM:SS`                                                                                                                                                                                                                                                                                                                   | CURRENT_TIMESTAMP = `2021-06-15 17:30:30`<br/><br/> `GET_TIMESTAMP()` -> `2021-06-15 17:30:30` <br/>`GET_TIMESTAMP(-300)` -> `2021-06-15 17:25:30` (5 minutes ago) <br/>`GET_TIMESTAMP(600)` -> `2021-06-15 17:40:30` (10 minutes later)                 |
| `BETWEEN(T1, T2) -> T1 AND T2`           | Category: `RANGE`<br/>  Generate `BETWEEN` statement with two time object, in order to comply with `BETWEEN` of most of SQL dialects.<br/>  - `T1` and `T2`: time parameter.<br/> Two options supported for Tn param:<br/> - Pass GET_DATE or GET_TIMESTAMP function to become param of `BETWEEN` <br/>- Pass any fixed datetime format with single quote, Ex: `'2021-06-15'` <br/> Return: `'YYYY-MM-DD' AND 'YYYY-MM-DD` -> First is T1 and later is T2 or `'YYYY-MM-DD HH24:MM:SS' AND 'YYYY-MM-DD HH24:MM:SS'` if you use `GET_TIMESTAMP` | CURRENT_TIMESTAMP = `2021-06-15 17:30:30` <br/><br/> `BETWEEN(GET_DATE(-2), GET_DATE(-1))` -> `'2021-06-13' AND '2021-06-14'` <br/><br/> `BETWEEN(GET_TIMESTAMP(-600), GET_TIMESTAMP(-300)` ->  `'2021-06-15 17:25:30' AND '2021-06-15 17:40:30'`  |
| `IN(T*) -> IN(T1, T2, ...)` | Category: `RANGE`<br/>   Generate `IN` statement with multiple T(`Time`) param.  <br/> Could be use together with YEAR/MONTH/DAY function in row-section below.  <br/> Param: `T*`: can pass as many T param as you want. <br/>  Return: `IN (YYYY-MM-DD, YYYY-MM-DD, ...)` as many as params passed.                                                                                                                                                                                                                                                                                           | CURRENT_DATE = `2021-06-15` <br/> <br/> `IN(GET_DATE(-7), GET_DATE(-1)` -> `IN ('2021-06-08', '2021-06-14')`  <br/><br/> `IN(MONTH(GET_DATE(-31), MONTH(GET_DATE(-1))` -> `IN (5,6)`                                                                                                                                                          |
| `YEAR(T)`<br/> `MONTH(T)` <br/>`DAY(T)`    | Category: `SINGLE` <br/> Param: T <br/>Return: YEAR/MONTH/DAY of given T time                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | CURRENT_DATE = `2021-06-15`<br/> <br/> `YEAR(GET_DATE())` -> `2021` <br/>`YEAR(GET_DATE())` -> `6`<br/> `YEAR(GET_DATE())` -> `15`  